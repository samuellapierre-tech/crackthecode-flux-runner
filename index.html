<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>CrackTheCode — Akira Breach Ops</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#02040a;
      --bg2:#050815;
      --accent:#b35cff;
      --accent-soft:rgba(179,92,255,0.3);
      --accent2:#00e0ff;
      --accent3:#ffd23f;
      --ok:#39ff14;
      --danger:#ff3055;
      --text:#e6eef8;
      --muted:#9aa6b2;
      font-family:"Fira Code","Inconsolata",ui-monospace,monospace;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      min-height:100vh;
      background:radial-gradient(circle at top,#141129 0%,#02040a 45%,#000 100%);
      color:var(--text);
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:16px;
    }
    .wrapper{
      width:100%;
      max-width:1280px;
    }
    h1{
      font-size:22px;
      color:var(--accent);
      text-shadow:0 0 16px rgba(179,92,255,0.9);
      letter-spacing:1px;
      margin-bottom:2px;
    }
    .subtitle{
      font-size:11px;
      color:var(--muted);
      margin-bottom:8px;
    }
    .subtitle span{
      color:var(--accent3);
    }
    .topbar{
      display:flex;
      justify-content:space-between;
      gap:14px;
      align-items:flex-end;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .controls-hint{
      font-size:10px;
      color:var(--muted);
      text-align:right;
      max-width:260px;
      line-height:1.4;
    }
    #gameContainer{
      position:relative;
      width:100%;
      aspect-ratio:16/9;
      max-height:720px;
      border-radius:18px;
      overflow:hidden;
      background:
        radial-gradient(circle at top,rgba(179,92,255,0.06),transparent),
        radial-gradient(circle at bottom,rgba(0,224,255,0.04),transparent),
        #02040a;
      box-shadow:0 22px 70px rgba(0,0,0,0.98);
      border:1px solid rgba(179,92,255,0.35);
      display:grid;
      grid-template-columns:2fr 1.4fr;
    }
    .column{
      position:relative;
      padding:10px;
    }
    .col-left{
      border-right:1px solid rgba(255,255,255,0.04);
    }
    .hud-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:9px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .hud-top .label{color:var(--accent3);}
    .det-bar-wrap{
      flex:1;
      margin:0 8px;
      height:6px;
      background:rgba(4,10,20,0.95);
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.04);
      overflow:hidden;
    }
    .det-bar{
      height:100%;
      width:0%;
      background:linear-gradient(90deg,var(--ok),var(--accent3),var(--danger));
      box-shadow:0 0 12px rgba(255,48,85,0.7);
      transition:width 0.2s ease-out;
    }
    .mini-label{
      font-size:8px;
      color:var(--muted);
    }
    .map{
      position:relative;
      width:100%;
      height:calc(100% - 26px);
      border-radius:12px;
      background:radial-gradient(circle at top,rgba(0,224,255,0.05),transparent),
                 linear-gradient(to bottom,rgba(4,10,20,0.96),#02040a);
      box-shadow:inset 0 0 22px rgba(0,0,0,0.85);
      overflow:hidden;
    }
    .grid-line{
      position:absolute;
      background:rgba(120,140,200,0.08);
      pointer-events:none;
    }
    .grid-line.v{
      width:1px;
      top:0;bottom:0;
    }
    .grid-line.h{
      height:1px;
      left:0;right:0;
    }
    .node{
      position:absolute;
      width:72px;
      padding:4px 4px 6px;
      border-radius:10px;
      background:rgba(5,10,25,0.96);
      border:1px solid rgba(179,92,255,0.26);
      box-shadow:0 6px 14px rgba(0,0,0,0.9);
      font-size:8px;
      color:var(--muted);
      cursor:pointer;
      display:flex;
      flex-direction:column;
      gap:1px;
      transition:all 0.16s ease-out;
    }
    .node .name{
      font-size:8px;
      color:var(--accent2);
      font-weight:600;
    }
    .node .type{
      font-size:7px;
      opacity:0.8;
    }
    .node .status{
      font-size:7px;
      color:var(--accent3);
    }
    .node.selected{
      border-color:var(--accent3);
      box-shadow:0 0 14px rgba(255,210,63,0.9);
      transform:translateY(-2px);
    }
    .node.compromised{
      border-color:var(--ok);
      box-shadow:0 0 12px rgba(57,255,20,0.7);
    }
    .node.detected{
      border-color:var(--danger);
      box-shadow:0 0 14px rgba(255,48,85,0.9);
    }
    .link{
      position:absolute;
      height:2px;
      background:linear-gradient(90deg,rgba(179,92,255,0.0),rgba(179,92,255,0.6),rgba(0,224,255,0.0));
      box-shadow:0 0 8px rgba(0,224,255,0.6);
      transform-origin:left center;
      opacity:0.7;
      pointer-events:none;
    }
    .panel{
      height:100%;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .panel-block{
      background:radial-gradient(circle at top left,rgba(179,92,255,0.12),transparent),
                 rgba(3,6,14,0.98);
      border-radius:10px;
      padding:8px;
      border:1px solid rgba(255,255,255,0.04);
      box-shadow:0 8px 18px rgba(0,0,0,0.95);
    }
    .panel-title{
      font-size:9px;
      color:var(--accent2);
      margin-bottom:4px;
      text-transform:uppercase;
      letter-spacing:1px;
    }
    #log{
      font-size:8px;
      color:var(--muted);
      max-height:110px;
      overflow-y:auto;
      line-height:1.5;
    }
    #log .entry.ok{color:var(--ok);}
    #log .entry.bad{color:var(--danger);}
    #log .entry.sys{color:var(--accent2);}
    #log .entry.lyra{color:var(--accent3);}
    #selected-info{
      font-size:8px;
      color:var(--muted);
      line-height:1.5;
      min-height:46px;
    }
    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      margin-top:2px;
    }
    .btn{
      flex:1 0 calc(50% - 4px);
      padding:6px 4px;
      border-radius:7px;
      border:1px solid rgba(179,92,255,0.5);
      background:rgba(6,10,22,0.98);
      color:var(--accent2);
      font-size:8px;
      cursor:pointer;
      text-align:center;
      transition:all 0.12s ease-out;
    }
    .btn span{
      font-size:7px;
      color:var(--muted);
      display:block;
      margin-top:1px;
    }
    .btn:hover{
      background:radial-gradient(circle at top,rgba(179,92,255,0.22),rgba(2,4,10,1));
      box-shadow:0 4px 12px rgba(0,0,0,1);
      transform:translateY(-1px);
    }
    .btn.disabled{
      opacity:0.25;
      cursor:default;
      box-shadow:none;
      transform:none;
    }
    .objective{
      font-size:8px;
      color:var(--muted);
      line-height:1.5;
    }
    .objective b{
      color:var(--accent3);
    }
    .end-overlay{
      position:absolute;
      inset:0;
      background:radial-gradient(circle at center,rgba(0,0,0,0.15),rgba(0,0,0,0.96));
      display:none;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:16px;
      z-index:10;
    }
    .end-overlay h2{
      font-size:18px;
      margin-bottom:4px;
      color:var(--accent3);
      text-shadow:0 0 14px rgba(255,210,63,1);
    }
    .end-overlay p{
      font-size:9px;
      color:var(--muted);
      max-width:360px;
      margin:0 auto 10px;
      line-height:1.5;
    }
    .end-overlay button{
      padding:7px 16px;
      border-radius:999px;
      border:none;
      background:linear-gradient(90deg,var(--accent),var(--accent3));
      color:#02040a;
      font-size:9px;
      font-weight:700;
      cursor:pointer;
      text-transform:uppercase;
      box-shadow:0 10px 26px rgba(0,0,0,1);
    }
    .end-overlay button:hover{
      transform:translateY(-2px);
    }
    .scanlines{
      position:absolute;
      inset:0;
      background:repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0.02),
        rgba(255,255,255,0.02) 1px,
        transparent 3px,
        transparent 4px
      );
      mix-blend-mode:soft-light;
      opacity:0.16;
      pointer-events:none;
      z-index:3;
    }
  </style>
</head>
<body>
<div class="wrapper">
  <div class="topbar">
    <div>
      <h1>Akira Breach Ops — Simulation Réseau CrackTheCode</h1>
      <div class="subtitle">
        Incarne <span>Sam</span>, guidé par <span>Lyra.exe</span>. Analyse un vrai schéma réseau (pare-feu, proxy, DMZ, DC).
        Choisis le bon chemin, limite la détection, récupère le fragment de <span>Kali</span>.
      </div>
    </div>
    <div class="controls-hint">
      Jeu style centre d'opérations :<br>
      — Clique un nœud sur la carte<br>
      — SCAN / PROBE / EXPLOIT / COVER<br>
      — Si détection atteint 100% → repéré<br>
      — Chaîne correcte Edge → DMZ → App → DB
    </div>
  </div>

  <div id="gameContainer">
    <div class="column col-left">
      <div class="hud-top">
        <div><span class="label">Détection :</span></div>
        <div class="det-bar-wrap"><div id="detBar" class="det-bar"></div></div>
        <div class="mini-label" id="detLabel">0% — discret</div>
      </div>
      <div class="map" id="map"></div>
    </div>

    <div class="column">
      <div class="panel">
        <div class="panel-block">
          <div class="panel-title">Console — Flux Lyra.exe</div>
          <div id="log"></div>
        </div>
        <div class="panel-block">
          <div class="panel-title">Nœud sélectionné</div>
          <div id="selected-info">Clique sur un nœud dans la carte pour afficher ses détails techniques.</div>
          <div class="actions">
            <button class="btn" id="btn-scan">SCAN<br><span>Analyse discrète (risque faible)</span></button>
            <button class="btn" id="btn-probe">PROBE<br><span>Fingerprint ciblé (risque moyen)</span></button>
            <button class="btn" id="btn-exploit">EXPLOIT<br><span>Accès ciblé (risque élevé)</span></button>
            <button class="btn" id="btn-cover">COVER<br><span>Nettoyage & réduction du bruit</span></button>
          </div>
        </div>
        <div class="panel-block">
          <div class="panel-title">Objectifs de mission</div>
          <div class="objective">
            <ul>
              <li>Ne pas dépasser <b>100%</b> de détection (sinon l'Alliance te repère).</li>
              <li>Compromettre dans l'ordre logique :
                <b>Passerelle Edge</b> → <b>Proxy DMZ</b> → <b>Serveur Applicatif</b> → <b>Base Kali DC</b>.
              </li>
              <li>Ne pas gaspiller des exploits sur IDS / Mail : c'est du bruit pur.</li>
              <li>Simulation pédagogique : hacking éthique & compréhension réseau.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="scanlines"></div>

    <div class="end-overlay" id="overlay-fail">
      <h2>INTRUSION DÉTECTÉE</h2>
      <p>
        Les capteurs de l'Alliance des Systèmes ont corrélé tes paquets. Session Sam coupée.
        Réessaie avec moins de scans inutiles et une meilleure chaîne de pivots.
      </p>
      <button id="retry-fail">Relancer la simulation</button>
    </div>

    <div class="end-overlay" id="overlay-win">
      <h2>ACCÈS KALI FRAGMENT // VALIDÉ</h2>
      <p>
        Tu as compromis Edge → Proxy → App → DC proprement, avec bruit maîtrisé.
        Lyra.exe a extrait un fragment de Kali. Utilise ce succès pour renvoyer vers un chapitre du livre ou un autre jeu CrackTheCode.
      </p>
      <button id="retry-win">Rejouer / Optimiser ton run</button>
    </div>
  </div>
</div>

<script>
(function(){
  "use strict";

  const nodesData = [
    { id:"edge", name:"Passerelle Edge", type:"Firewall d'entrée ISP", role:"Point de passage initial. Pivot logique #1.", x:9,  y:52 },
    { id:"proxy",name:"Proxy DMZ",       type:"Reverse Proxy / WAF",   role:"Protège les applis. Pivot #2 si Edge est propre.", x:28, y:40 },
    { id:"app",  name:"Serveur Applicatif",type:"App CrackTheCode",   role:"Logique métier. Pivot #3 vers la base Kali.", x:52, y:30 },
    { id:"db",   name:"Base Kali DC",    type:"Data Center",           role:"Contient les fragments Kali. Cible finale.", x:78, y:38 },
    { id:"ids",  name:"IDS / SIEM",      type:"Surveillance",          role:"Voit les scans bourrins & exploits ratés.", x:40, y:68 },
    { id:"mail", name:"Serveur Mail",    type:"Service annexe",        role:"Mauvais pivot = alerte.", x:64, y:60 }
  ];

  const linksData = [
    ["edge","proxy"],
    ["proxy","app"],
    ["app","db"],
    ["proxy","ids"],
    ["app","mail"]
  ];

  const stageOrder = ["edge","proxy","app","db"];

  const state = {
    detection:0,
    compromised:[],
    selected:null,
    locked:false
  };

  const mapEl = document.getElementById("map");
  const logEl = document.getElementById("log");
  const selInfoEl = document.getElementById("selected-info");
  const detBar = document.getElementById("detBar");
  const detLabel = document.getElementById("detLabel");
  const hudNodes = document.getElementById("hud-nodes");
  const hudStatus = document.getElementById("hud-status");
  const overlayFail = document.getElementById("overlay-fail");
  const overlayWin = document.getElementById("overlay-win");
  const retryFail = document.getElementById("retry-fail");
  const retryWin = document.getElementById("retry-win");
  const btnScan = document.getElementById("btn-scan");
  const btnProbe = document.getElementById("btn-probe");
  const btnExploit = document.getElementById("btn-exploit");
  const btnCover = document.getElementById("btn-cover");

  const nodeElements = {};

  function buildGrid(){
    for(let x=0;x<=100;x+=10){
      const v=document.createElement("div");
      v.className="grid-line v";
      v.style.left=x+"%";
      v.style.opacity=(x%20===0)?"0.16":"0.06";
      mapEl.appendChild(v);
    }
    for(let y=0;y<=100;y+=12){
      const h=document.createElement("div");
      h.className="grid-line h";
      h.style.top=y+"%";
      h.style.opacity=(y%24===0)?"0.18":"0.06";
      mapEl.appendChild(h);
    }
  }

  function buildNodes(){
    nodesData.forEach(n=>{
      const el=document.createElement("div");
      el.className="node";
      el.style.left=n.x+"%";
      el.style.top=n.y+"%";
      el.dataset.id=n.id;
      el.innerHTML =
        '<div class="name">'+n.name+'</div>' +
        '<div class="type">'+n.type+'</div>' +
        '<div class="status">Status: intact</div>';
      el.addEventListener("click",()=>selectNode(n.id));
      mapEl.appendChild(el);
      nodeElements[n.id]=el;
    });
  }

  function buildLinks(){
    linksData.forEach(([a,b])=>{
      const na=nodeElements[a];
      const nb=nodeElements[b];
      if(!na||!nb) return;
      const ax=na.offsetLeft+na.offsetWidth/2;
      const ay=na.offsetTop+na.offsetHeight/2;
      const bx=nb.offsetLeft+nb.offsetWidth/2;
      const by=nb.offsetTop+nb.offsetHeight/2;
      const dx=bx-ax;
      const dy=by-ay;
      const dist=Math.sqrt(dx*dx+dy*dy);
      const angle=Math.atan2(dy,dx)*180/Math.PI;
      const link=document.createElement("div");
      link.className="link";
      link.style.width=dist+"px";
      link.style.left=ax+"px";
      link.style.top=ay+"px";
      link.style.transform="rotate("+angle+"deg)";
      mapEl.appendChild(link);
    });
  }

  function log(type,msg){
    const div=document.createElement("div");
    div.classList.add("entry");
    if(type==="ok") div.classList.add("ok");
    else if(type==="bad") div.classList.add("bad");
    else if(type==="sys") div.classList.add("sys");
    else if(type==="lyra") div.classList.add("lyra");
    const prefix={ok:"[OK] ",bad:"[ALERTE] ",sys:"[SYS] ",lyra:"[LYRA] "}[type] || "";
    div.textContent=prefix+msg;
    logEl.appendChild(div);
    logEl.scrollTop=logEl.scrollHeight;
  }

  function setDetection(delta){
    state.detection=Math.max(0,Math.min(100,state.detection+delta));
    detBar.style.width=state.detection+"%";
    let label=state.detection+"% — discret";
    if(state.detection>20) label=state.detection+"% — surveillé";
    if(state.detection>50) label=state.detection+"% — chaud";
    if(state.detection>80) label=state.detection+"% — critique";
    detLabel.textContent=label;
    if(state.detection>=100) fail();
  }

  function updateNodesHUD(){
    const count=state.compromised.length;
    if(hudNodes) hudNodes.textContent=count+"/4";
  }

  function selectNode(id){
    if(state.locked) return;
    state.selected=id;
    Object.values(nodeElements).forEach(el=>el.classList.remove("selected"));
    const el=nodeElements[id];
    if(el) el.classList.add("selected");
    const node=nodesData.find(n=>n.id===id);
    if(node){
      selInfoEl.innerHTML =
        "<b>"+node.name+"</b><br>"+node.type+
        "<br>"+node.role+
        "<br><span style=\"color:"+getComputedStyle(document.body).getPropertyValue('--accent-soft')+"\">Actions disponibles à droite.</span>";
    }
  }

  function getStage(){ return state.compromised.length; }
  function isCorrectNext(id){ return stageOrder[getStage()]===id; }
  function isCompromised(id){ return state.compromised.includes(id); }

  function scan(){
    if(!state.selected || state.locked) return;
    const node=nodesData.find(n=>n.id===state.selected);
    if(!node) return;
    if(isCorrectNext(node.id)){
      log("ok","Scan discret sur "+node.name+" : surface d'attaque intéressante.");
      setDetection(3);
    } else {
      log("bad","Scan bruyant sur "+node.name+" : traces envoyées au SIEM.");
      nodeElements[node.id].classList.add("detected");
      setDetection(8);
    }
  }

  function probe(){
    if(!state.selected || state.locked) return;
    const node=nodesData.find(n=>n.id===state.selected);
    if(!node) return;
    if(isCorrectNext(node.id)){
      log("ok","Probe ciblé sur "+node.name+" : vulnérabilité exploitable trouvée.");
      setDetection(6);
    } else {
      log("bad","Fingerprint agressif sur "+node.name+" : corrélé par l'IDS.");
      nodeElements[node.id].classList.add("detected");
      setDetection(14);
    }
  }

  function exploit(){
    if(!state.selected || state.locked) return;
    const node=nodesData.find(n=>n.id===state.selected);
    if(!node) return;
    if(isCompromised(node.id)){
      log("sys",node.name+" est déjà sous contrôle.");
      setDetection(2);
      return;
    }
    const must=stageOrder[getStage()];
    if(node.id===must){
      state.compromised.push(node.id);
      const el=nodeElements[node.id];
      el.classList.add("compromised");
      const st=el.querySelector(".status");
      if(st) st.textContent="Status: compromis contrôlé";
      log("ok","Accès établi sur "+node.name+" (pivot "+state.compromised.length+"/4).");
      setDetection(10);
      updateNodesHUD();
      if(node.id==="edge") log("lyra","Parfait. Maintenant le Proxy DMZ, pas les jouets.");
      else if(node.id==="proxy") log("lyra","Carré. De là, vise l'app, pas l'IDS.");
      else if(node.id==="app") log("lyra","Encore un saut propre et Kali est à portée.");
      if(node.id==="db") win();
      else if(hudStatus) hudStatus.textContent="INSIDE: "+node.id.toUpperCase();
    } else {
      log("bad","Exploit raté sur "+node.name+" : alerte critique.");
      nodeElements[node.id].classList.add("detected");
      setDetection(22);
    }
  }

  function cover(){
    if(state.locked) return;
    if(state.detection<=0){
      log("sys","Aucune trace à effacer.");
      return;
    }
    const gain=10;
    state.detection=Math.max(0,state.detection-gain);
    detBar.style.width=state.detection+"%";
    detLabel.textContent=state.detection+"% — discrétion améliorée";
    log("ok","Nettoyage de logs & rotation d'empreintes : -"+gain+"% détection.");
  }

  function fail(){
    if(state.locked) return;
    state.locked=true;
    if(hudStatus) hudStatus.textContent="TRACÉ";
    log("bad","L'Alliance des Systèmes a triangulé Sam. Session terminée.");
    overlayFail.style.display="flex";
  }

  function win(){
    if(state.locked) return;
    state.locked=true;
    if(hudStatus) hudStatus.textContent="KALI//LINK";
    log("ok","Chaîne complète compromise proprement. Fragment de Kali exfiltré.");
    log("lyra","On a ce qu'il nous faut. Connecte ce succès au reste de CrackTheCode.");
    overlayWin.style.display="flex";
  }

  function reset(){
    state.detection=0;
    state.compromised=[];
    state.selected=null;
    state.locked=false;
    detBar.style.width="0%";
    detLabel.textContent="0% — discret";
    if(hudStatus) hudStatus.textContent="STABLE";
    if(hudNodes) hudNodes.textContent="0/4";
    logEl.innerHTML="";
    selInfoEl.textContent="Clique sur un nœud dans la carte pour afficher ses détails techniques.";
    Object.values(nodeElements).forEach(el=>{
      el.classList.remove("selected","compromised","detected");
      const st=el.querySelector(".status");
      if(st) st.textContent="Status: intact";
    });
    overlayFail.style.display="none";
    overlayWin.style.display="none";
    log("sys","Simulation Akira Breach Ops réinitialisée.");
    log("lyra","On recommence. Moins de bruit, plus de cerveau.");
  }

  btnScan.addEventListener("click",scan);
  btnProbe.addEventListener("click",probe);
  btnExploit.addEventListener("click",exploit);
  btnCover.addEventListener("click",cover);
  retryFail.addEventListener("click",reset);
  retryWin.addEventListener("click",reset);

  buildGrid();
  buildNodes();
  setTimeout(buildLinks,40);

  log("sys","Chargement topologie Akira City / CrackTheCode...");
  log("lyra","Clique sur Edge. Si tu commences par l'IDS, je coupe le câble moi-même.");
})();
</script>
</body>
</html>
